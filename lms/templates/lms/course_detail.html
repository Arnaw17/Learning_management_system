{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ course.title }} | Course Details</title>
    <link rel="stylesheet" href="{% static 'css/instructordash.css' %}">
    
    <style>
        .detail-wrapper { padding: 120px 50px 50px; max-width: 1000px; margin: 0 auto; }
        .purchase-box { background: #fff3cd; border: 1px solid #ffeeba; padding: 25px; border-radius: 8px; margin-top: 30px; text-align: center; }
        .locked-content { background: #f8d7da; border: 1px solid #f5c6cb; padding: 20px; text-align: center; margin-top: 20px; border-radius: 8px; }
        .media-preview { margin-top: 20px; background: #e9ecef; padding: 15px; border-radius: 6px; }
        .buy-btn { background: #28a745; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="detail-wrapper">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <h1>{{ course.title }}</h1>
        <p class="text-muted">By: {{ course.instructor.user.get_full_name|default:course.instructor.user.username }} | Level: {{ course.level }}</p>
        
        <hr>

        <h2>Short Summary</h2>
        <p>{{ course.short_description }}</p>

        {% if not has_access %}
            <div class="purchase-box">
                <p>This course is currently locked. Purchase full access for **${{ course.price|floatformat:2 }}**.</p>
                
                {% if not is_logged_in %}
                    <a href="{% url 'student_login' %}" class="buy-btn" style="background:#007bff; text-decoration:none; display:inline-block;">Login to Purchase</a>
                    <p style="margin-top: 10px;">(Only logged-in users can buy courses.)</p>
                {% else %}
                    <form method="POST" action="{% url 'purchase_course' %}">
                        {% csrf_token %}
                        <input type="hidden" name="course_id" value="{{ course.pk }}">
                        <button type="submit" class="buy-btn">Buy Now (${{ course.price|floatformat:2 }})</button>
                    </form>
                {% endif %}
            </div>
        {% endif %}

        <h2 style="margin-top: 40px;">Detailed Curriculum</h2>
        <p>{{ course.detailed_description|linebreaksbr }}</p>
        
        <h3>Course Outline Preview</h3>
        <pre style="white-space: pre-wrap; background: #f0f0f0; padding: 15px; border-radius: 4px;">{{ course.outline }}</pre>

        {% if course.image %}
            <h3 style="margin-top: 30px;">Course Thumbnail</h3>
            <img src="{{ course.image.url }}" alt="Course Thumbnail" style="max-width: 400px; height: auto; border-radius: 8px;">
        {% endif %}

        <hr style="margin-top: 40px;">

        <h2 style="margin-top: 40px;">Lessons & Resources</h2>

        {% if has_access %}
            <p style="color: green; font-weight: bold;">âœ… Full Access Granted! Enjoy the course content.</p>

            {% if course.course_video %}
                <h3>Full Course Video</h3>
                <video controls width="100%" height="auto">
                    <source src="{{ course.course_video.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            {% else %}
                <p>No primary video uploaded yet.</p>
            {% endif %}

            {% if course.notes_file %}
                <h3 style="margin-top: 20px;">Downloadable Notes</h3>
                <a href="{{ course.notes_file.url }}" download class="buy-btn" style="background:#007bff; text-decoration:none;">Download PDF/Notes</a>
            {% else %}
                <p>No downloadable notes available.</p>
            {% endif %}

        {% else %}
            <div class="locked-content">
                <h3>Content Locked</h3>
                <p>The full video lessons and notes file are reserved for enrolled students.</p>
                {% if is_logged_in %}
                    <p>Purchase the course above to unlock this content immediately.</p>
                {% else %}
                    <p>Please log in or purchase the course to view the full curriculum.</p>
                {% endif %}
            </div>
        {% endif %}
    </div>

    </body>
</html>